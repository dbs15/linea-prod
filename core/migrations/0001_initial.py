# Generated by Django 4.2.16 on 2025-09-18 20:57

from django.conf import settings
import django.contrib.auth.models
import django.contrib.auth.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone
import django_fsm


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('role', models.CharField(choices=[('super_admin', 'Super Administrador'), ('admin_company', 'Administrador de Empresa'), ('aux_registro', 'Auxiliar de Registro'), ('aux_tostion', 'Auxiliar de Tostión'), ('aux_produccion', 'Auxiliar de Producción'), ('aux_facturacion', 'Auxiliar de Facturación')], default='aux_registro', max_length=20, verbose_name='Rol')),
                ('phone', models.CharField(blank=True, max_length=20, verbose_name='Teléfono')),
                ('is_active', models.BooleanField(default=True, verbose_name='Activo')),
                ('last_access', models.DateTimeField(blank=True, null=True, verbose_name='Último acceso')),
            ],
            options={
                'verbose_name': 'Usuario',
                'verbose_name_plural': 'Usuarios',
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='Client',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('first_name', models.CharField(max_length=50, verbose_name='Nombres')),
                ('last_name', models.CharField(max_length=50, verbose_name='Apellidos')),
                ('document_type', models.CharField(choices=[('cc', 'Cédula'), ('nit', 'NIT')], default='cc', max_length=10, verbose_name='Tipo de documento')),
                ('document_number', models.CharField(max_length=20, verbose_name='Número de documento')),
                ('phone', models.CharField(max_length=20, verbose_name='Teléfono')),
                ('email', models.EmailField(max_length=254, verbose_name='Email')),
                ('address', models.TextField(verbose_name='Dirección')),
                ('city', models.CharField(blank=True, default='', max_length=50, verbose_name='Ciudad')),
                ('client_type', models.CharField(choices=[('new', 'Nuevo'), ('frequent', 'Frecuente'), ('vip', 'VIP')], default='new', max_length=10, verbose_name='Tipo de cliente')),
                ('is_active', models.BooleanField(default=True, verbose_name='Activo')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Cliente',
                'verbose_name_plural': 'Clientes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Company',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre de la empresa')),
                ('slug', models.SlugField(blank=True, unique=True, verbose_name='Slug único')),
                ('nit', models.CharField(max_length=20, unique=True, verbose_name='NIT')),
                ('phone', models.CharField(max_length=20, verbose_name='Teléfono')),
                ('email', models.EmailField(max_length=254, verbose_name='Email')),
                ('address', models.TextField(verbose_name='Dirección')),
                ('city', models.CharField(blank=True, default='', max_length=50, verbose_name='Ciudad')),
                ('status', models.CharField(choices=[('active', 'Activa'), ('suspended', 'Suspendida'), ('cancelled', 'Cancelada')], default='active', max_length=20, verbose_name='Estado')),
                ('plan', models.CharField(choices=[('basic', 'Básico'), ('premium', 'Premium'), ('enterprise', 'Enterprise')], default='basic', max_length=20, verbose_name='Plan de suscripción')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Fecha de creación')),
                ('suspended_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de suspensión')),
                ('suspension_reason', models.TextField(blank=True, verbose_name='Motivo de suspensión')),
                ('billing_email', models.EmailField(blank=True, max_length=254, verbose_name='Email de facturación')),
                ('last_payment_date', models.DateField(blank=True, null=True, verbose_name='Último pago')),
                ('next_payment_date', models.DateField(blank=True, null=True, verbose_name='Próximo pago')),
            ],
            options={
                'verbose_name': 'Empresa',
                'verbose_name_plural': 'Empresas',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Order',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order_number', models.CharField(max_length=20, unique=True, verbose_name='Número de pedido')),
                ('quantity_kg', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Cantidad en KG')),
                ('coffee_type', models.CharField(choices=[('cps', 'CPS (Café Pergamino Seco)'), ('excelso', 'Excelso'), ('supremo', 'Supremo'), ('extra', 'Extra')], default='excelso', max_length=20, verbose_name='Tipo de café')),
                ('price_per_kg', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Precio por KG')),
                ('total_amount', models.DecimalField(decimal_places=2, editable=False, max_digits=15, verbose_name='Total')),
                ('packaging_type', models.CharField(max_length=100, verbose_name='Tipo de empaque')),
                ('packaging_details', models.TextField(blank=True, verbose_name='Detalles de empaque')),
                ('delivery_method', models.CharField(choices=[('pickup', 'Recogida en local'), ('delivery', 'Entrega a domicilio'), ('shipping', 'Envío por transporte')], default='pickup', max_length=20, verbose_name='Forma de entrega')),
                ('delivery_address', models.TextField(blank=True, verbose_name='Dirección de entrega')),
                ('committed_date', models.DateField(verbose_name='Fecha comprometida')),
                ('state', django_fsm.FSMField(choices=[('registered', 'Registrado'), ('in_toasting', 'En Tostión'), ('toasting_complete', 'Tostión Completa'), ('in_production', 'En Producción'), ('ready_for_billing', 'Listo para Facturar'), ('billed', 'Facturado'), ('delivered', 'Entregado'), ('cancelled', 'Cancelado')], default='registered', max_length=50, protected=True, verbose_name='Estado')),
                ('registered_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Fecha de registro')),
                ('toasting_started_at', models.DateTimeField(blank=True, null=True, verbose_name='Inicio de tostión')),
                ('toasting_completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Fin de tostión')),
                ('production_started_at', models.DateTimeField(blank=True, null=True, verbose_name='Inicio de producción')),
                ('production_completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Fin de producción')),
                ('billed_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de facturación')),
                ('delivered_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de entrega')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('internal_notes', models.TextField(blank=True, verbose_name='Notas internas')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('billed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='billed_orders', to=settings.AUTH_USER_MODEL, verbose_name='Facturado por')),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='orders', to='core.client', verbose_name='Cliente')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='orders', to='core.company')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_orders', to=settings.AUTH_USER_MODEL, verbose_name='Creado por')),
                ('delivered_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delivered_orders', to=settings.AUTH_USER_MODEL, verbose_name='Entregado por')),
                ('produced_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='produced_orders', to=settings.AUTH_USER_MODEL, verbose_name='Producido por')),
                ('toasted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='toasted_orders', to=settings.AUTH_USER_MODEL, verbose_name='Tostado por')),
            ],
            options={
                'verbose_name': 'Pedido',
                'verbose_name_plural': 'Pedidos',
                'ordering': ['-created_at'],
                'permissions': [('can_manage_orders', 'Puede gestionar pedidos'), ('can_view_all_orders', 'Puede ver todos los pedidos')],
            },
        ),
        migrations.CreateModel(
            name='ToastingProcess',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('received_at', models.DateTimeField(auto_now_add=True, verbose_name='Fecha de recepción')),
                ('started_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de inicio')),
                ('completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de finalización')),
                ('received_quantity_kg', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Kilos recibidos')),
                ('processed_quantity_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Kilos procesados')),
                ('yield_percentage', models.DecimalField(blank=True, decimal_places=2, editable=False, max_digits=5, null=True, verbose_name='Rendimiento (%)')),
                ('temperature_celsius', models.DecimalField(decimal_places=1, max_digits=5, verbose_name='Temperatura (°C)')),
                ('toasting_time_minutes', models.PositiveIntegerField(verbose_name='Tiempo de tostión (min)')),
                ('roast_type', models.CharField(choices=[('light', 'Claro'), ('medium', 'Medio'), ('dark', 'Oscuro')], max_length=20, verbose_name='Tipo de tueste')),
                ('grain_quality', models.CharField(choices=[('excellent', 'Excelente'), ('good', 'Buena'), ('regular', 'Regular'), ('poor', 'Deficiente')], max_length=20, verbose_name='Calidad del grano')),
                ('quality_notes', models.TextField(blank=True, verbose_name='Notas de calidad')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('order', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='toasting_process', to='core.order', verbose_name='Pedido')),
                ('processed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='toasting_processes', to=settings.AUTH_USER_MODEL, verbose_name='Procesado por')),
            ],
            options={
                'verbose_name': 'Proceso de Tostión',
                'verbose_name_plural': 'Procesos de Tostión',
                'ordering': ['-received_at'],
            },
        ),
        migrations.CreateModel(
            name='ProductionProcess',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('started_at', models.DateTimeField(auto_now_add=True, verbose_name='Fecha de inicio')),
                ('completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Fecha de finalización')),
                ('process_type', models.CharField(choices=[('grinding', 'Molido'), ('packaging', 'Empacado'), ('bulk', 'Granel')], max_length=20, verbose_name='Proceso realizado')),
                ('grinding_type', models.CharField(blank=True, choices=[('fine', 'Fino'), ('medium', 'Medio'), ('coarse', 'Grueso')], max_length=20, null=True, verbose_name='Tipo de molido')),
                ('packaging_details', models.TextField(verbose_name='Detalles de empaque')),
                ('weight_check', models.BooleanField(default=False, verbose_name='Control de peso ✓')),
                ('packaging_check', models.BooleanField(default=False, verbose_name='Control de empaque ✓')),
                ('labeling_check', models.BooleanField(default=False, verbose_name='Control de etiquetado ✓')),
                ('final_weight_kg', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Peso total producido (KG)')),
                ('units_produced', models.PositiveIntegerField(verbose_name='Unidades producidas')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('order', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='production_process', to='core.order', verbose_name='Pedido')),
                ('processed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='production_processes', to=settings.AUTH_USER_MODEL, verbose_name='Procesado por')),
            ],
            options={
                'verbose_name': 'Proceso de Producción',
                'verbose_name_plural': 'Procesos de Producción',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='Invoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('invoice_number', models.CharField(max_length=20, unique=True, verbose_name='Número de factura')),
                ('issue_date', models.DateField(default=django.utils.timezone.now, verbose_name='Fecha de emisión')),
                ('due_date', models.DateField(verbose_name='Fecha de vencimiento')),
                ('payment_date', models.DateField(blank=True, null=True, verbose_name='Fecha de pago')),
                ('subtotal', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Subtotal')),
                ('tax_rate', models.DecimalField(decimal_places=2, default=19, max_digits=5, verbose_name='Tasa de impuesto (%)')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=15, verbose_name='Valor del impuesto')),
                ('total_amount', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=15, verbose_name='Total')),
                ('status', models.CharField(choices=[('pending', 'Pendiente'), ('paid', 'Pagada'), ('overdue', 'Vencida'), ('cancelled', 'Cancelada')], default='pending', max_length=20, verbose_name='Estado')),
                ('delivery_person', models.CharField(blank=True, max_length=100, verbose_name='Persona que entrega')),
                ('recipient_person', models.CharField(blank=True, max_length=100, verbose_name='Persona que recibe')),
                ('delivery_notes', models.TextField(blank=True, verbose_name='Notas de entrega')),
                ('notes', models.TextField(blank=True, verbose_name='Notas')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='invoices', to='core.company')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_invoices', to=settings.AUTH_USER_MODEL, verbose_name='Creada por')),
                ('order', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='invoice', to='core.order', verbose_name='Pedido')),
            ],
            options={
                'verbose_name': 'Factura',
                'verbose_name_plural': 'Facturas',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='client',
            name='company',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='clients', to='core.company'),
        ),
        migrations.AddField(
            model_name='user',
            name='company',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='users', to='core.company', verbose_name='Empresa'),
        ),
        migrations.AddField(
            model_name='user',
            name='groups',
            field=models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups'),
        ),
        migrations.AddField(
            model_name='user',
            name='user_permissions',
            field=models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions'),
        ),
        migrations.AlterUniqueTogether(
            name='client',
            unique_together={('company', 'document_number')},
        ),
        migrations.CreateModel(
            name='ActivityLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('login', 'Inicio de sesión'), ('logout', 'Cierre de sesión'), ('order_create', 'Creación de pedido'), ('order_update', 'Actualización de pedido'), ('toasting_start', 'Inicio de tostión'), ('toasting_complete', 'Tostión completada'), ('production_start', 'Inicio de producción'), ('production_complete', 'Producción completada'), ('invoice_create', 'Creación de factura'), ('invoice_payment', 'Pago de factura'), ('company_create', 'Creación de empresa'), ('company_suspend', 'Empresa suspendida'), ('company_activate', 'Empresa activada'), ('user_create', 'Creación de usuario'), ('user_update', 'Actualización de usuario')], max_length=30, verbose_name='Acción')),
                ('description', models.TextField(verbose_name='Descripción')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='Dirección IP')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Fecha y hora')),
                ('company', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='activities', to='core.company', verbose_name='Empresa')),
                ('related_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='activities', to='core.invoice', verbose_name='Factura relacionada')),
                ('related_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='activities', to='core.order', verbose_name='Pedido relacionado')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='activities', to=settings.AUTH_USER_MODEL, verbose_name='Usuario')),
            ],
            options={
                'verbose_name': 'Log de Actividad',
                'verbose_name_plural': 'Logs de Actividad',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['user', 'timestamp'], name='core_activi_user_id_81b1f1_idx'), models.Index(fields=['company', 'timestamp'], name='core_activi_company_e611c8_idx'), models.Index(fields=['action', 'timestamp'], name='core_activi_action_549521_idx')],
            },
        ),
    ]
